<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Chat</title>
</head>
<body>
  <h1>WebSocket Chat</h1>
  <div>
    <span id="user-count"></span> users online:<br>
    <ul id="user-list"></ul>
  </div>
  <div>
    <ul id="chat-log"></ul>
    <form id="message-form">
      <input type="text" id="name" placeholder="Your name">
      <input type="text" id="message" placeholder="Type your message...">
      <button type="submit">Send</button>
    </form>
  </div>
  <script>
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const socket = new WebSocket(`${protocol}//${window.location.host}`);

    const userCountElement = document.getElementById('user-count');
    const userListElement = document.getElementById('user-list');
    const chatLogElement = document.getElementById('chat-log');
    const messageForm = document.getElementById('message-form');
    const nameInput = document.getElementById('name');
    const messageInput = document.getElementById('message');

    function updateUsersOnline(usersOnline) {
      userCountElement.textContent = usersOnline.length;
      userListElement.innerHTML = '';
      usersOnline.forEach((username) => {
        const li = document.createElement('li');
        li.textContent = username;
        userListElement.appendChild(li);
      });
    }

    socket.addEventListener('message', (event) => {
      const data = JSON.parse(event.data);

      if (data.type === 'userCount') {
        updateUsersOnline(data.usersOnline);
      } else if (data.type === 'notification') {
        const li = document.createElement('li');
        li.textContent = data.message;
        chatLogElement.appendChild(li);
      } else if (data.type === 'message') {
        const li = document.createElement('li');
        li.textContent = data.message;
        chatLogElement.appendChild(li);
      }
    });

    messageForm.addEventListener('submit', (event) => {
      event.preventDefault();

      const name = nameInput.value.trim();
      const message = messageInput.value.trim();

      if (!name || !message) {
        return;
      }

      const data = {
        type: 'message',
        name,
        message,
      };

      socket.send(JSON.stringify(data));

      messageInput.value = '';
      messageInput.focus();
    });
  </script>
</body>
</html>