<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Chat App</title>
    <style>
      #messages {
        height: 300px;
        overflow: scroll;
      }
    </style>
  </head>
  <body>
    <h1>Chat App</h1>
    <div>
      <label for="name">Name:</label>
      <input type="text" id="name" />
      <button onclick="joinChat()">Join Chat</button>
    </div>
    <div>
      <label for="message">Message:</label>
      <input type="text" id="message" />
      <button onclick="sendMessage()">Send</button>
    </div>
    <div>
      <p>Users online: <span id="user-count">0</span></p>
    </div>
    <div id="messages"></div>
    <div id="users"></div>
    <script>
      const nameInput = document.getElementById('name');
      const messageInput = document.getElementById('message');
      const messagesDiv = document.getElementById('messages');
      const usersDiv = document.getElementById('users');
      const userCountSpan = document.getElementById('user-count');

      const socket = new WebSocket('ws://localhost:4000');

      socket.addEventListener('open', (event) => {
        console.log('Connected to server');
      });

      socket.addEventListener('message', (event) => {
        const messageObj = JSON.parse(event.data);
        if (messageObj.type === 'notification' || messageObj.type === 'message') {
          const message = document.createElement('p');
          message.textContent = messageObj.message;
          messagesDiv.appendChild(message);
        } else if (messageObj.type === 'userCount') {
          userCountSpan.textContent = messageObj.count;
        } else if (messageObj.type === 'users') {
          usersDiv.textContent = '';
          messageObj.users.forEach((user) => {
            const userElement = document.createElement('p');
            userElement.textContent = user.name;
            usersDiv.appendChild(userElement);
          });
        }
      });

      function joinChat() {
        const name = nameInput.value;
        if (name) {
          const messageObj = { type: 'join', name };
          socket.send(JSON.stringify(messageObj));
        }
      }

      function sendMessage() {
        const name = nameInput.value;
        const message = messageInput.value;
        if (name && message) {
          const messageObj = { type: 'message', name, message };
          socket.send(JSON.stringify(messageObj));
          messageInput.value = '';
        }
      }
    </script>
  </body>
</html>